<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Avançado de Colisões - Cinética Química</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --accent: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --background: #1a2530;
            --card-bg: #243241;
            --slider-bg: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--background) 0%, #16202b 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--light);
            opacity: 0.8;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }
        
        .simulation-area {
            position: relative;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        canvas {
            display: block;
            background: #0d1721;
        }
        
        .controls-sidebar {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-section {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.1rem;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .slider-value {
            font-weight: bold;
            color: var(--secondary);
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: var(--slider-bg);
            border-radius: 3px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        button {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-start {
            background: var(--secondary);
        }
        
        .btn-pause {
            background: #f39c12;
        }
        
        .btn-reset {
            background: var(--accent);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary);
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--light);
            opacity: 0.8;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .color-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .reaction-equation {
            text-align: center;
            margin: 15px 0;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        
        .info-panel {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            max-width: 250px;
            backdrop-filter: blur(5px);
        }
        
        .tutorial {
            margin-top: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .tutorial h3 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tutorial-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .tutorial-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .tutorial-item i {
            color: var(--secondary);
            font-size: 1.2rem;
            margin-top: 3px;
        }
        
        .progress-bar {
            height: 6px;
            background: var(--slider-bg);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--secondary);
            border-radius: 3px;
            width: 0%;
            transition: width 0.5s;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .tutorial-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-atom"></i> Simulador de Colisões Moleculares</h1>
            <p class="subtitle">Explore os princípios da cinética química através de simulações interativas</p>
        </header>
        
        <div class="main-content">
            <div class="simulation-area">
                <canvas id="gameCanvas" width="800" height="500"></canvas>
                
                <div class="info-panel">
                    <p><i class="fas fa-info-circle"></i> Clique em partículas para obter informações</p>
                    <p><i class="fas fa-mouse-pointer"></i> Arraste para criar barreiras</p>
                </div>
                
                <div class="reaction-equation">
                    A + B → AB
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="color-dot" style="background-color: #3498db;"></div>
                        <span>Molécula A</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background-color: #e74c3c;"></div>
                        <span>Molécula B</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background-color: #2ecc71;"></div>
                        <span>Produto AB</span>
                    </div>
                </div>
            </div>
            
            <div class="controls-sidebar">
                <div class="control-section">
                    <h3 class="section-title"><i class="fas fa-sliders-h"></i> Controles de Simulação</h3>
                    
                    <div class="button-group">
                        <button id="startBtn" class="btn-start"><i class="fas fa-play"></i> Iniciar</button>
                        <button id="pauseBtn" class="btn-pause"><i class="fas fa-pause"></i> Pausar</button>
                        <button id="resetBtn" class="btn-reset"><i class="fas fa-redo"></i> Reiniciar</button>
                        <button id="helpBtn"><i class="fas fa-question-circle"></i> Ajuda</button>
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Velocidade de Simulação</span>
                            <span class="slider-value" id="speedValue">1.0x</span>
                        </div>
                        <input type="range" id="simulationSpeed" min="0.1" max="3" step="0.1" value="1">
                        <div class="progress-bar">
                            <div class="progress-fill" id="speedProgress"></div>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3 class="section-title"><i class="fas fa-vial"></i> Condições da Reação</h3>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Temperatura</span>
                            <span class="slider-value" id="tempValue">300 K</span>
                        </div>
                        <input type="range" id="temperature" min="200" max="500" value="300">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Concentração de A</span>
                            <span class="slider-value" id="concAValue">50%</span>
                        </div>
                        <input type="range" id="concentrationA" min="10" max="90" value="50">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Concentração de B</span>
                            <span class="slider-value" id="concBValue">50%</span>
                        </div>
                        <input type="range" id="concentrationB" min="10" max="90" value="50">
                    </div>
                </div>
                
                <div class="control-section">
                    <h3 class="section-title"><i class="fas fa-bolt"></i> Parâmetros da Reação</h3>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Energia de Ativação</span>
                            <span class="slider-value" id="energyValue">50%</span>
                        </div>
                        <input type="range" id="activationEnergy" min="10" max="90" value="50">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Probabilidade de Reação</span>
                            <span class="slider-value" id="probValue">70%</span>
                        </div>
                        <input type="range" id="reactionProbability" min="10" max="90" value="70">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Pressão</span>
                            <span class="slider-value" id="pressureValue">1.0 atm</span>
                        </div>
                        <input type="range" id="pressure" min="0.5" max="3" step="0.1" value="1">
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="collisions">0</div>
                        <div class="stat-label">Colisões/s</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="reactions">0</div>
                        <div class="stat-label">Reações/s</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="products">0</div>
                        <div class="stat-label">Produtos</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="energy">0</div>
                        <div class="stat-label">Energia média</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tutorial">
            <h3><i class="fas fa-graduation-cap"></i> Como Funciona a Cinética Química</h3>
            <div class="tutorial-content">
                <div class="tutorial-item">
                    <i class="fas fa-thermometer-half"></i>
                    <div>
                        <strong>Temperatura:</strong> Aumenta a energia cinética das moléculas, 
                        resultando em colisões mais frequentes e energéticas.
                    </div>
                </div>
                <div class="tutorial-item">
                    <i class="fas fa-flask"></i>
                    <div>
                        <strong>Concentração:</strong> Maior concentração aumenta a probabilidade 
                        de colisões entre as moléculas reagentes.
                    </div>
                </div>
                <div class="tutorial-item">
                    <i class="fas fa-bolt"></i>
                    <div>
                        <strong>Energia de Ativação:</strong> Energia mínima necessária para 
                        que uma colisão resulte em reação química.
                    </div>
                </div>
                <div class="tutorial-item">
                    <i class="fas fa-compress-arrows-alt"></i>
                    <div>
                        <strong>Pressão:</strong> Em sistemas gasosos, maior pressão diminui o 
                        espaço entre moléculas, aumentando as colisões.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuração do canvas e contexto
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Elementos de controle
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const helpBtn = document.getElementById('helpBtn');
        const temperatureSlider = document.getElementById('temperature');
        const concentrationASlider = document.getElementById('concentrationA');
        const concentrationBSlider = document.getElementById('concentrationB');
        const activationEnergySlider = document.getElementById('activationEnergy');
        const reactionProbabilitySlider = document.getElementById('reactionProbability');
        const pressureSlider = document.getElementById('pressure');
        const simulationSpeedSlider = document.getElementById('simulationSpeed');
        
        // Elementos de exibição de valores
        const tempValue = document.getElementById('tempValue');
        const concAValue = document.getElementById('concAValue');
        const concBValue = document.getElementById('concBValue');
        const energyValue = document.getElementById('energyValue');
        const probValue = document.getElementById('probValue');
        const pressureValue = document.getElementById('pressureValue');
        const speedValue = document.getElementById('speedValue');
        const collisionsDisplay = document.getElementById('collisions');
        const reactionsDisplay = document.getElementById('reactions');
        const productsDisplay = document.getElementById('products');
        const energyDisplay = document.getElementById('energy');
        const speedProgress = document.getElementById('speedProgress');
        
        // Variáveis de estado do jogo
        let animationId = null;
        let isRunning = false;
        let particles = [];
        let barriers = [];
        let collisionsPerSecond = 0;
        let reactionsPerSecond = 0;
        let totalProducts = 0;
        let averageEnergy = 0;
        let lastUpdateTime = 0;
        let collisionCounter = 0;
        let reactionCounter = 0;
        let isDragging = false;
        let selectedParticle = null;
        
        // Constantes e configurações
        const PARTICLE_COUNT = 120;
        const PARTICLE_RADIUS = 8;
        const PARTICLE_COLORS = {
            A: '#3498db',  // Azul para moléculas A
            B: '#e74c3c',  // Vermelho para moléculas B
            AB: '#2ecc71'  // Verde para produtos AB
        };
        
        // Classe para representar uma partícula
        class Particle {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.radius = PARTICLE_RADIUS;
                this.color = PARTICLE_COLORS[type];
                this.energy = 0;
                this.highlight = false;
                this.highlightTimer = 0;
                
                // Velocidade inicial aleatória baseada na temperatura
                const speed = 1 + Math.random() * (getTemperatureFactor() * 3);
                const angle = Math.random() * Math.PI * 2;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
            }
            
            update(deltaTime) {
                // Atualizar posição
                const speedFactor = getSimulationSpeed();
                this.x += this.vx * speedFactor;
                this.y += this.vy * speedFactor;
                
                // Ajustar velocidade baseado na temperatura atual
                const tempFactor = getTemperatureFactor();
                this.vx *= 0.99; // Pequena resistência para evitar aceleração infinita
                this.vy *= 0.99;
                
                this.vx += (Math.random() - 0.5) * tempFactor * 0.2 * speedFactor;
                this.vy += (Math.random() - 0.5) * tempFactor * 0.2 * speedFactor;
                
                // Calcular energia (proporcional à velocidade ao quadrado)
                this.energy = (this.vx * this.vx + this.vy * this.vy) * 0.5;
                
                // Manter a velocidade dentro de limites razoáveis
                const maxSpeed = 5 + tempFactor * 3;
                const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                if (speed > maxSpeed) {
                    this.vx = (this.vx / speed) * maxSpeed;
                    this.vy = (this.vy / speed) * maxSpeed;
                }
                
                // Verificar colisões com as bordas
                if (this.x - this.radius < 0) {
                    this.x = this.radius;
                    this.vx = Math.abs(this.vx);
                } else if (this.x + this.radius > canvas.width) {
                    this.x = canvas.width - this.radius;
                    this.vx = -Math.abs(this.vx);
                }
                
                if (this.y - this.radius < 0) {
                    this.y = this.radius;
                    this.vy = Math.abs(this.vy);
                } else if (this.y + this.radius > canvas.height) {
                    this.y = canvas.height - this.radius;
                    this.vy = -Math.abs(this.vy);
                }
                
                // Verificar colisões com barreiras
                for (const barrier of barriers) {
                    this.checkBarrierCollision(barrier);
                }
                
                // Atualizar highlight
                if (this.highlight) {
                    this.highlightTimer -= deltaTime;
                    if (this.highlightTimer <= 0) {
                        this.highlight = false;
                    }
                }
            }
            
            checkBarrierCollision(barrier) {
                // Colisão simplificada com barreiras lineares
                const { x1, y1, x2, y2 } = barrier;
                
                // Calcular a distância do ponto à linha
                const A = this.x - x1;
                const B = this.y - y1;
                const C = x2 - x1;
                const D = y2 - y1;
                
                const dot = A * C + B * D;
                const len_sq = C * C + D * D;
                let param = -1;
                
                if (len_sq !== 0) {
                    param = dot / len_sq;
                }
                
                let xx, yy;
                
                if (param < 0) {
                    xx = x1;
                    yy = y1;
                } else if (param > 1) {
                    xx = x2;
                    yy = y2;
                } else {
                    xx = x1 + param * C;
                    yy = y1 + param * D;
                }
                
                const dx = this.x - xx;
                const dy = this.y - yy;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance <= this.radius) {
                    // Colisão detectada, refletir a partícula
                    const length = Math.sqrt(C * C + D * D);
                    const normalX = -D / length;
                    const normalY = C / length;
                    
                    const dotProduct = this.vx * normalX + this.vy * normalY;
                    
                    this.vx -= 2 * dotProduct * normalX;
                    this.vy -= 2 * dotProduct * normalY;
                    
                    // Mover a partícula para fora da barreira
                    this.x = xx + normalX * (this.radius + 1);
                    this.y = yy + normalY * (this.radius + 1);
                }
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                if (this.highlight) {
                    ctx.fillStyle = '#ffffff';
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = this.color;
                } else {
                    ctx.fillStyle = this.color;
                    ctx.shadowBlur = 0;
                }
                
                ctx.fill();
                ctx.closePath();
                
                // Desenhar borda
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.stroke();
                ctx.closePath();
                
                // Desenhar indicador de energia para partículas destacadas
                if (this.highlight) {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    const energyScale = Math.min(this.energy / 20, 1);
                    const lineLength = 20 * energyScale;
                    ctx.lineTo(this.x + lineLength, this.y);
                    ctx.strokeStyle = '#ffeb3b';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.closePath();
                }
            }
            
            isPointInside(x, y) {
                const dx = this.x - x;
                const dy = this.y - y;
                return dx * dx + dy * dy <= this.radius * this.radius;
            }
        }
        
        // Funções auxiliares
        function getTemperatureFactor() {
            return temperatureSlider.value / 300; // 300K como referência
        }
        
        function getActivationEnergy() {
            return activationEnergySlider.value / 100;
        }
        
        function getReactionProbability() {
            return reactionProbabilitySlider.value / 100;
        }
        
        function getPressureFactor() {
            return pressureSlider.value;
        }
        
        function getSimulationSpeed() {
            return simulationSpeedSlider.value;
        }
        
        // Inicializar partículas
        function initializeParticles() {
            particles = [];
            barriers = [];
            totalProducts = 0;
            
            const concA = concentrationASlider.value / 100;
            const concB = concentrationBSlider.value / 100;
            
            // Ajustar para garantir que a soma não ultrapasse 100%
            const totalConc = concA + concB;
            const adjustedConcA = concA / totalConc;
            const adjustedConcB = concB / totalConc;
            
            for (let i = 0; i < PARTICLE_COUNT * getPressureFactor(); i++) {
                const type = Math.random() < adjustedConcA ? 'A' : 'B';
                const x = PARTICLE_RADIUS + Math.random() * (canvas.width - PARTICLE_RADIUS * 2);
                const y = PARTICLE_RADIUS + Math.random() * (canvas.height - PARTICLE_RADIUS * 2);
                
                particles.push(new Particle(x, y, type));
            }
        }
        
        // Verificar colisões entre partículas
        function checkCollisions() {
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const p1 = particles[i];
                    const p2 = particles[j];
                    
                    const dx = p2.x - p1.x;
                    const dy = p2.y - p1.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < p1.radius + p2.radius) {
                        // Registrar colisão
                        collisionCounter++;
                        
                        // Verificar se é uma colisão reativa (A + B)
                        if ((p1.type === 'A' && p2.type === 'B') || 
                            (p1.type === 'B' && p2.type === 'A')) {
                            
                            // A reação ocorre apenas se a energia for suficiente
                            const energy = (Math.abs(p1.vx) + Math.abs(p1.vy) + 
                                          Math.abs(p2.vx) + Math.abs(p2.vy)) / 4;
                            const activationEnergy = getActivationEnergy() * 5;
                            
                            if (energy > activationEnergy && 
                                Math.random() < getReactionProbability()) {
                                // Registrar reação
                                reactionCounter++;
                                totalProducts++;
                                
                                // Criar produto AB no ponto médio
                                const midX = (p1.x + p2.x) / 2;
                                const midY = (p1.y + p2.y) / 2;
                                
                                // Remover as partículas originais
                                particles.splice(j, 1);
                                particles.splice(i, 1);
                                
                                // Adicionar o produto AB
                                const product = new Particle(midX, midY, 'AB');
                                
                                // Dar ao produto uma velocidade resultante
                                product.vx = (p1.vx + p2.vx) / 2;
                                product.vy = (p1.vy + p2.vy) / 2;
                                
                                particles.push(product);
                                
                                // Sair dos loops pois o array foi modificado
                                return;
                            }
                        }
                        
                        // Colisão elástica (não reativa)
                        const angle = Math.atan2(dy, dx);
                        const sin = Math.sin(angle);
                        const cos = Math.cos(angle);
                        
                        // Rotacionar o sistema de coordenadas
                        const vx1 = p1.vx * cos + p1.vy * sin;
                        const vy1 = p1.vy * cos - p1.vx * sin;
                        const vx2 = p2.vx * cos + p2.vy * sin;
                        const vy2 = p2.vy * cos - p2.vx * sin;
                        
                        // Trocar velocidades no eixo x
                        const temp = vx1;
                        p1.vx = vx2 * cos - vy1 * sin;
                        p1.vy = vy1 * cos + vx2 * sin;
                        p2.vx = temp * cos - vy2 * sin;
                        p2.vy = vy2 * cos + temp * sin;
                        
                        // Separar as partículas para evitar sobreposição
                        const overlap = (p1.radius + p2.radius) - distance;
                        p1.x -= overlap * cos / 2;
                        p1.y -= overlap * sin / 2;
                        p2.x += overlap * cos / 2;
                        p2.y += overlap * sin / 2;
                    }
                }
            }
        }
        
        // Desenhar barreiras
        function drawBarriers() {
            for (const barrier of barriers) {
                ctx.beginPath();
                ctx.moveTo(barrier.x1, barrier.y1);
                ctx.lineTo(barrier.x2, barrier.y2);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.lineWidth = 3;
                ctx.stroke();
                ctx.closePath();
            }
        }
        
        // Loop principal de animação
        function animate(timestamp) {
            if (!isRunning) return;
            
            // Calcular delta time
            const deltaTime = timestamp - lastUpdateTime || 0;
            lastUpdateTime = timestamp;
            
            // Limpar o canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar barreiras
            drawBarriers();
            
            // Atualizar e desenhar partículas
            let totalEnergy = 0;
            for (const particle of particles) {
                particle.update(deltaTime);
                particle.draw();
                totalEnergy += particle.energy;
            }
            
            // Calcular energia média
            averageEnergy = particles.length > 0 ? totalEnergy / particles.length : 0;
            
            // Verificar colisões
            checkCollisions();
            
            // Atualizar estatísticas a cada segundo
            if (deltaTime > 0) {
                collisionsPerSecond = Math.round(collisionCounter * 1000 / deltaTime);
                reactionsPerSecond = Math.round(reactionCounter * 1000 / deltaTime);
                
                collisionsDisplay.textContent = collisionsPerSecond;
                reactionsDisplay.textContent = reactionsPerSecond;
                productsDisplay.textContent = totalProducts;
                energyDisplay.textContent = averageEnergy.toFixed(1);
                
                collisionCounter = 0;
                reactionCounter = 0;
            }
            
            animationId = requestAnimationFrame(animate);
        }
        
        // Controladores do jogo
        function startGame() {
            if (!isRunning) {
                isRunning = true;
                lastUpdateTime = 0;
                animationId = requestAnimationFrame(animate);
                startBtn.innerHTML = '<i class="fas fa-play"></i> Executando';
                startBtn.style.opacity = '0.7';
            }
        }
        
        function pauseGame() {
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            startBtn.innerHTML = '<i class="fas fa-play"></i> Iniciar';
            startBtn.style.opacity = '1';
        }
        
        function resetGame() {
            pauseGame();
            initializeParticles();
            collisionsPerSecond = 0;
            reactionsPerSecond = 0;
            totalProducts = 0;
            averageEnergy = 0;
            
            collisionsDisplay.textContent = '0';
            reactionsDisplay.textContent = '0';
            productsDisplay.textContent = '0';
            energyDisplay.textContent = '0';
            
            // Redesenhar as partículas iniciais
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBarriers();
            particles.forEach(particle => particle.draw());
        }
        
        // Mostrar informações da partícula
        function showParticleInfo(particle) {
            particle.highlight = true;
            particle.highlightTimer = 2000; // 2 segundos
            
            // Criar tooltip com informações
            const tooltip = document.createElement('div');
            tooltip.style.position = 'absolute';
            tooltip.style.left = (particle.x + 20) + 'px';
            tooltip.style.top = (particle.y - 10) + 'px';
            tooltip.style.background = 'rgba(0, 0, 0, 0.8)';
            tooltip.style.color = 'white';
            tooltip.style.padding = '8px';
            tooltip.style.borderRadius = '5px';
            tooltip.style.zIndex = '100';
            tooltip.style.pointerEvents = 'none';
            tooltip.innerHTML = `
                <strong>Tipo: ${particle.type}</strong><br>
                Energia: ${particle.energy.toFixed(2)}<br>
                Velocidade: ${Math.sqrt(particle.vx*particle.vx + particle.vy*particle.vy).toFixed(2)}
            `;
            
            document.body.appendChild(tooltip);
            
            // Remover tooltip após 2 segundos
            setTimeout(() => {
                document.body.removeChild(tooltip);
            }, 2000);
        }
        
        // Event listeners para controles
        startBtn.addEventListener('click', startGame);
        pauseBtn.addEventListener('click', pauseGame);
        resetBtn.addEventListener('click', resetGame);
        
        temperatureSlider.addEventListener('input', () => {
            tempValue.textContent = temperatureSlider.value + ' K';
        });
        
        concentrationASlider.addEventListener('input', () => {
            concAValue.textContent = concentrationASlider.value + '%';
            // Ajustar B para manter a proporção
            const remaining = 100 - parseInt(concentrationASlider.value);
            concentrationBSlider.value = remaining;
            concBValue.textContent = remaining + '%';
        });
        
        concentrationBSlider.addEventListener('input', () => {
            concBValue.textContent = concentrationBSlider.value + '%';
            // Ajustar A para manter a proporção
            const remaining = 100 - parseInt(concentrationBSlider.value);
            concentrationASlider.value = remaining;
            concAValue.textContent = remaining + '%';
        });
        
        activationEnergySlider.addEventListener('input', () => {
            energyValue.textContent = activationEnergySlider.value + '%';
        });
        
        reactionProbabilitySlider.addEventListener('input', () => {
            probValue.textContent = reactionProbabilitySlider.value + '%';
        });
        
        pressureSlider.addEventListener('input', () => {
            pressureValue.textContent = pressureSlider.value + ' atm';
        });
        
        simulationSpeedSlider.addEventListener('input', () => {
            const speed = simulationSpeedSlider.value;
            speedValue.textContent = speed + 'x';
            speedProgress.style.width = (speed / 3 * 100) + '%';
        });
        
        // Event listeners para interação com o canvas
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Verificar se clicou em uma partícula
            for (const particle of particles) {
                if (particle.isPointInside(x, y)) {
                    showParticleInfo(particle);
                    return;
                }
            }
        });
        
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            barriers.push({
                x1: x,
                y1: y,
                x2: x,
                y2: y
            });
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (isDragging && barriers.length > 0) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                barriers[barriers.length - 1].x2 = x;
                barriers[barriers.length - 1].y2 = y;
            }
        });
        
        canvas.addEventListener('mouseup', () => {
            isDragging = false;
        });
        
        helpBtn.addEventListener('click', () => {
            alert('Simulador de Colisões Moleculares\n\n' +
                  'Este simulador demonstra os princípios da cinética química:\n\n' +
                  '- Ajuste a temperatura para alterar a energia das moléculas\n' +
                  '- Modifique as concentrações para alterar a probabilidade de colisões\n' +
                  '- A energia de ativação determina a energia mínima necessária para a reação\n' +
                  '- A pressão afeta a frequência de colisões\n\n' +
                  'Clique em partículas para ver informações detalhadas.\n' +
                  'Arraste no canvas para criar barreiras que afetam o movimento das moléculas.');
        });
        
        // Inicializar o jogo
        initializeParticles();
        drawBarriers();
        particles.forEach(particle => particle.draw());
        
        // Atualizar visualização dos sliders
        speedProgress.style.width = (simulationSpeedSlider.value / 3 * 100) + '%';
    </script>
</body>
</html>
